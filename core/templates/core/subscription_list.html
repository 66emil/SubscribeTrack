{% extends 'core/base.html' %}

{% block title %}–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏ - –ú–µ–Ω–µ–¥–∂–µ—Ä –ü–æ–¥–ø–∏—Å–æ–∫{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h1>üí≥ –ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏</h1>
        <a href="{% url 'subscription-create' %}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É</a>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid">
        <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <h3>{{ total_subscriptions }}</h3>
            <p>–í—Å–µ–≥–æ –ø–æ–¥–ø–∏—Å–æ–∫</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
            <h3>{{ active_subscriptions }}</h3>
            <p>–ê–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫</p>
        </div>
        <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
            <h3>{{ total_monthly_cost }} ‚ÇΩ</h3>
            <p>–ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</p>
        </div>
    </div>

    {% if subscriptions %}
        <table>
            <thead>
                <tr>
                    <th>–ö–æ–º–ø–∞–Ω–∏—è</th>
                    <th>–ü–ª–∞–Ω</th>
                    <th>–¶–µ–Ω–∞</th>
                    <th>–ü–µ—Ä–∏–æ–¥</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°–ª–µ–¥. –ø–ª–∞—Ç–µ–∂</th>
                    <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                </tr>
            </thead>
            <tbody>
                {% for subscription in subscriptions %}
                <tr>
                    <td>
                        <strong>{{ subscription.company.name }}</strong><br>
                        <small style="color: #7f8c8d;">{{ subscription.company.category.name }}</small>
                    </td>
                    <td>{{ subscription.plan_name }}</td>
                    <td><strong>{{ subscription.price }} ‚ÇΩ</strong></td>
                    <td>{{ subscription.get_billing_period_display }}</td>
                    <td>
                        <span style="padding: 4px 8px; border-radius: 4px; font-size: 0.85rem; 
                            {% if subscription.status == 'active' %}background: #d4edda; color: #155724;
                            {% elif subscription.status == 'cancelled' %}background: #f8d7da; color: #721c24;
                            {% elif subscription.status == 'expired' %}background: #d6d8d9; color: #383d41;
                            {% elif subscription.status == 'paused' %}background: #fff3cd; color: #856404;
                            {% endif %}">
                            {{ subscription.get_status_display }}
                        </span>
                    </td>
                    <td>{{ subscription.next_billing_date|date:"d.m.Y" }}</td>
                    <td>
                        <a href="{% url 'subscription-detail' subscription.pk %}" class="btn" style="padding: 6px 12px; font-size: 12px;">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>
                        <a href="{% url 'subscription-update' subscription.pk %}" class="btn" style="padding: 6px 12px; font-size: 12px;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                        <a href="{% url 'subscription-delete' subscription.pk %}" class="btn btn-danger" style="padding: 6px 12px; font-size: 12px;">–£–¥–∞–ª–∏—Ç—å</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if is_paginated %}
        <div class="pagination">
            {% if page_obj.has_previous %}
                <a href="?page=1">–ü–µ—Ä–≤–∞—è</a>
                <a href="?page={{ page_obj.previous_page_number }}">–ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
            {% endif %}
            
            <span style="padding: 8px 12px;">
                –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
            </span>
            
            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">–°–ª–µ–¥—É—é—â–∞—è</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">–ü–æ—Å–ª–µ–¥–Ω—è—è</a>
            {% endif %}
        </div>
        {% endif %}
    {% else %}
        <p style="text-align: center; padding: 40px; color: #7f8c8d;">
            –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ–¥–ø–∏—Å–æ–∫. <a href="{% url 'subscription-create' %}">–î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—É—é –ø–æ–¥–ø–∏—Å–∫—É!</a>
        </p>
    {% endif %}
</div>
{% endblock %}

